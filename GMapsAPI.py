import googlemaps
from datetime import datetime


class GMapsAPI:
    SAMPLE_ROUTE_FORMAT = {1: {'coordinates': [(43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ['Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}, 2: {'coordinates': [(43.659248, -79.390289), (43.6562811, -79.380459), (43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ["Walk to Queen's Park", 'Subway towards Yonge-University to Finch Station', 'Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}, 3: {'coordinates': [(43.6596826, -79.3907918), (43.6614659, -79.3828636), (43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ["Walk to College St at University Ave - Queen's Park Station", 'Streetcar towards Carlton to Main Street Station', 'Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}, 4: {'coordinates': [(43.659248, -79.390289), (43.6562811, -79.380459), (43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ["Walk to Queen's Park", 'Subway towards Yonge-University to Finch Station', 'Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}, 5: {'coordinates': [(43.6639524, -79.3871578), (43.657212, -79.3845424), (43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ['Walk to Bay St at Wellesley St West South Side', 'Bus towards Bay to Queens Quay and Sherbourne', 'Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}, 6: {'coordinates': [(43.6596826, -79.3907918), (43.6614659, -79.3828636), (43.6574131, -79.3810817), (43.6574131, -79.3810817)], 'steps': ["Walk to College St at University Ave - Queen's Park Station", 'Streetcar towards Carlton to Main Street Station', 'Walk to 335 Yonge St, Toronto, ON M5B 2L3, Canada']}}
    SAMPLE_CRIME_HEAVY = {1: {'coordinates': [(43.6585663, -79.39721589999999), (43.659308, -79.397475), (43.6600245, -79.3970369), (43.6600684, -79.396902), (43.66452169999999, -79.3987034), (43.66452169999999, -79.3987034)], 'steps': ['Head <b>east</b> on <b>College St</b>', 'Turn <b>left</b><div style="font-size:0.9em">Take the stairs</div>', 'Walk for 110m', 'Head <b>northeast</b> toward <b>St George St</b>', 'Turn <b>left</b> onto <b>St George St</b><div style="font-size:0.9em">Destination will be on the right</div>']}, 2: {'coordinates': [(43.6587964, -79.39596569999999), (43.66452169999999, -79.3987034), (43.66452169999999, -79.3987034)], 'steps': ['Head <b>east</b> on <b>College St</b> toward <b>Ross St</b>', 'Sharp <b>left</b> onto <b>St George St</b><div style="font-size:0.9em">Destination will be on the right</div>']}, 3: {'coordinates': [(43.6583516, -79.3983101), (43.6600712, -79.3989983), (43.6601575, -79.39864209999999), (43.6631998, -79.3998648), (43.6632239, -79.3997809), (43.6635859, -79.39915429999999), (43.6636271, -79.3991293), (43.6639272, -79.3985749), (43.66452169999999, -79.3987034), (43.66452169999999, -79.3987034)], 'steps': ['Head <b>west</b> on <b>College St</b> toward <b>Huron St</b>', 'Turn <b>right</b> onto <b>Huron St</b>', 'Turn <b>right</b> onto <b>Ursula Franklin St</b>', 'Turn <b>left</b> onto <b>Huron St</b>', 'Turn <b>right</b> toward <b>Harbord St</b>', 'Slight <b>left</b> toward <b>Harbord St</b>', 'Turn <b>left</b> toward <b>Harbord St</b>', 'Turn <b>right</b> onto <b>Harbord St</b>', 'Turn <b>left</b> onto <b>St George St</b><div style="font-size:0.9em">Destination will be on the right</div>']}}
    SAMPLE_SPADINA_STGEORGE = [{'bounds': {'northeast': {'lat': 43.6673353, 'lng': -79.3987105}, 'southwest': {'lat': 43.6645201, 'lng': -79.40401580000001}}, 'copyrights': 'Map data ©2023 Google', 'legs': [{'distance': {'text': '0.7 km', 'value': 706}, 'duration': {'text': '10 mins', 'value': 574}, 'end_address': '130 St George St, Toronto, ON M5S 1A5, Canada', 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'start_address': 'Spadina, Spadina Ave., Toronto, ON M5R 2S9, Canada', 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'steps': [{'distance': {'text': '0.3 km', 'value': 320}, 'duration': {'text': '4 mins', 'value': 263}, 'end_location': {'lat': 43.6646465, 'lng': -79.40252050000001}, 'html_instructions': 'Head <b>south</b> on <b>Spadina Rd</b> toward <b>Bloor St W</b>', 'polyline': {'points': '{woiGbrscNLEDARKFCD?TIZKJG?CZS?@TMLGJGBC@AHE@ALKNORSLIHGHEVMJELEFE?ANC?@d@MNENIp@SNCPGAAPG'}, 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'travel_mode': 'WALKING'}, {'distance': {'text': '0.2 km', 'value': 238}, 'duration': {'text': '3 mins', 'value': 198}, 'end_location': {'lat': 43.6652151, 'lng': -79.3997513}, 'html_instructions': 'Turn <b>left</b> onto <b>Sussex Ave</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'agoiGvhscNOqA?EEUAICKKs@K}@AMAICQCWCIG[?YAIGk@CSS{ACK'}, 'start_location': {'lat': 43.6646465, 'lng': -79.40252050000001}, 'travel_mode': 'WALKING'}, {'distance': {'text': '7 m', 'value': 7}, 'duration': {'text': '1 min', 'value': 6}, 'end_location': {'lat': 43.6652057, 'lng': -79.3997464}, 'html_instructions': 'Turn <b>right</b> toward <b>St George St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'sjoiGlwrcN@?'}, 'start_location': {'lat': 43.6652151, 'lng': -79.3997513}, 'travel_mode': 'WALKING'}, {'distance': {'text': '75 m', 'value': 75}, 'duration': {'text': '1 min', 'value': 58}, 'end_location': {'lat': 43.6651293, 'lng': -79.3989582}, 'html_instructions': 'Turn <b>left</b> toward <b>St George St</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'qjoiGlwrcN@MAG?CAC?E?E?E?C?C?CBWDa@Fg@'}, 'start_location': {'lat': 43.6652057, 'lng': -79.3997464}, 'travel_mode': 'WALKING'}, {'distance': {'text': '66 m', 'value': 66}, 'duration': {'text': '1 min', 'value': 49}, 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'html_instructions': 'Turn <b>right</b> onto <b>St George St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'ajoiGnrrcNPGLENEJELEFAHCFCTG'}, 'start_location': {'lat': 43.6651293, 'lng': -79.3989582}, 'travel_mode': 'WALKING'}], 'traffic_speed_entry': [], 'via_waypoint': []}], 'overview_polyline': {'points': '{woiGbrscNrBu@?CZSTK^Uh@c@`@]RMx@_@NEd@K^O`AWPGAAPGOqAE[EU[iCSoAAc@K_AWgBBMCU?SPeBbBi@TG'}, 'summary': 'Spadina Rd and Sussex Ave', 'warnings': ['Walking directions are in beta. Use caution – This route may be missing sidewalks or pedestrian paths.'], 'waypoint_order': []}, {'bounds': {'northeast': {'lat': 43.6673965, 'lng': -79.3987105}, 'southwest': {'lat': 43.6645201, 'lng': -79.40401580000001}}, 'copyrights': 'Map data ©2023 Google', 'legs': [{'distance': {'text': '0.8 km', 'value': 754}, 'duration': {'text': '10 mins', 'value': 611}, 'end_address': '130 St George St, Toronto, ON M5S 1A5, Canada', 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'start_address': 'Spadina, Spadina Ave., Toronto, ON M5R 2S9, Canada', 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'steps': [{'distance': {'text': '78 m', 'value': 78}, 'duration': {'text': '1 min', 'value': 64}, 'end_location': {'lat': 43.6666207, 'lng': -79.4036319}, 'html_instructions': 'Head <b>south</b> on <b>Spadina Rd</b> toward <b>Bloor St W</b>', 'polyline': {'points': '{woiGbrscNLEDARKFCD?TIZKJG?CZS'}, 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'travel_mode': 'WALKING'}, {'distance': {'text': '0.3 km', 'value': 331}, 'duration': {'text': '5 mins', 'value': 277}, 'end_location': {'lat': 43.6673965, 'lng': -79.3998912}, 'html_instructions': 'Turn <b>left</b> onto <b>Bloor St W</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'ksoiGtoscNIe@CUAKEc@O_ACa@E_@Ik@CWG[OiA?EG]?EE[C_@SeBI]UiB'}, 'start_location': {'lat': 43.6666207, 'lng': -79.4036319}, 'travel_mode': 'WALKING'}, {'distance': {'text': '0.3 km', 'value': 345}, 'duration': {'text': '5 mins', 'value': 270}, 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'html_instructions': 'Turn <b>right</b> onto <b>St George St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'gxoiGhxrcNf@ONEHCJCLGj@QFCnA_@@AXKB?JCLEXKFAZKLEBAJCLE@H@ANEAGTI`@MHCLENEJELEFAHCFCTG'}, 'start_location': {'lat': 43.6673965, 'lng': -79.3998912}, 'travel_mode': 'WALKING'}], 'traffic_speed_entry': [], 'via_waypoint': []}], 'overview_polyline': {'points': '{woiGbrscNrBu@?CZSM{@Go@O_ACa@OkAKs@WmBIaA]cCUiBf@OXIXKr@UpAa@v@UjA_@NELE@HPGAGTIj@Q\\Kj@Q\\K'}, 'summary': 'Bloor St W and St George St', 'warnings': ['Walking directions are in beta. Use caution – This route may be missing sidewalks or pedestrian paths.'], 'waypoint_order': []}, {'bounds': {'northeast': {'lat': 43.6673353, 'lng': -79.3987105}, 'southwest': {'lat': 43.6645201, 'lng': -79.40401580000001}}, 'copyrights': 'Map data ©2023 Google', 'legs': [{'distance': {'text': '0.7 km', 'value': 733}, 'duration': {'text': '10 mins', 'value': 591}, 'end_address': '130 St George St, Toronto, ON M5S 1A5, Canada', 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'start_address': 'Spadina, Spadina Ave., Toronto, ON M5R 2S9, Canada', 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'steps': [{'distance': {'text': '78 m', 'value': 78}, 'duration': {'text': '1 min', 'value': 64}, 'end_location': {'lat': 43.6666207, 'lng': -79.4036319}, 'html_instructions': 'Head <b>south</b> on <b>Spadina Rd</b> toward <b>Bloor St W</b>', 'polyline': {'points': '{woiGbrscNLEDARKFCD?TIZKJG?CZS'}, 'start_location': {'lat': 43.6673353, 'lng': -79.40401580000001}, 'travel_mode': 'WALKING'}, {'distance': {'text': '0.2 km', 'value': 189}, 'duration': {'text': '3 mins', 'value': 162}, 'end_location': {'lat': 43.6670457, 'lng': -79.40158780000002}, 'html_instructions': 'Turn <b>left</b> onto <b>Bloor St W</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'ksoiGtoscNIe@CUAKEc@O_ACa@E_@Ik@CWG[OiA'}, 'start_location': {'lat': 43.6666207, 'lng': -79.4036319}, 'travel_mode': 'WALKING'}, {'distance': {'text': '0.2 km', 'value': 242}, 'duration': {'text': '3 mins', 'value': 188}, 'end_location': {'lat': 43.6650254, 'lng': -79.4007618}, 'html_instructions': 'Turn <b>right</b> onto <b>Huron St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'avoiG|bscNfA[NElA_@PI`@IPG`@MrAa@`@ONG'}, 'start_location': {'lat': 43.6670457, 'lng': -79.40158780000002}, 'travel_mode': 'WALKING'}, {'distance': {'text': '76 m', 'value': 76}, 'duration': {'text': '1 min', 'value': 64}, 'end_location': {'lat': 43.6652151, 'lng': -79.3997513}, 'html_instructions': 'Turn <b>left</b> onto <b>Sussex Ave</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'mioiGv}rcN?WAIGk@CSS{ACK'}, 'start_location': {'lat': 43.6650254, 'lng': -79.4007618}, 'travel_mode': 'WALKING'}, {'distance': {'text': '7 m', 'value': 7}, 'duration': {'text': '1 min', 'value': 6}, 'end_location': {'lat': 43.6652057, 'lng': -79.3997464}, 'html_instructions': 'Turn <b>right</b> toward <b>St George St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'sjoiGlwrcN@?'}, 'start_location': {'lat': 43.6652151, 'lng': -79.3997513}, 'travel_mode': 'WALKING'}, {'distance': {'text': '75 m', 'value': 75}, 'duration': {'text': '1 min', 'value': 58}, 'end_location': {'lat': 43.6651293, 'lng': -79.3989582}, 'html_instructions': 'Turn <b>left</b> toward <b>St George St</b>', 'maneuver': 'turn-left', 'polyline': {'points': 'qjoiGlwrcN@MAG?CAC?E?E?E?C?C?CBWDa@Fg@'}, 'start_location': {'lat': 43.6652057, 'lng': -79.3997464}, 'travel_mode': 'WALKING'}, {'distance': {'text': '66 m', 'value': 66}, 'duration': {'text': '1 min', 'value': 49}, 'end_location': {'lat': 43.6645201, 'lng': -79.3987105}, 'html_instructions': 'Turn <b>right</b> onto <b>St George St</b>', 'maneuver': 'turn-right', 'polyline': {'points': 'ajoiGnrrcNPGLENEJELEFAHCFCTG'}, 'start_location': {'lat': 43.6651293, 'lng': -79.3989582}, 'travel_mode': 'WALKING'}], 'traffic_speed_entry': [], 'via_waypoint': []}], 'overview_polyline': {'points': '{woiGbrscNrBu@?CZSM{@Go@O_ACa@OkAKs@OiAfA[|Ae@fBi@tBq@NG?WIu@WoBAa@Ae@Hy@Fg@PG\\KXKn@Q'}, 'summary': 'Bloor St W and Huron St', 'warnings': ['Walking directions are in beta. Use caution – This route may be missing sidewalks or pedestrian paths.'], 'waypoint_order': []}]
    def __int__(self):
        pass

    def getRoutes(self, origin: any, destination: any, travel_mode: str):
        """
        Parameters:
        -origin/destination: this has been tested on inputs with origin and destination as a string representing
        longitude and latitude as follows:
            origin = "41.03, 56.00"
        -travel_mode: can be "driving", "walking", "bicycling", "transit"
        """
        print('danger:made api call')
        gmaps = googlemaps.Client(key='AIzaSyAtO23OblmhtyzSFk9Kah5FSbPUd-9FQQk')

        # Request multiple routes with alternative routes
        routes = gmaps.directions(
            origin,
            destination,
            mode=travel_mode,
            departure_time=datetime.now(),
            alternatives=True  # Request multiple routes
        )
        print(routes)
        return routes

    def getRoutesFormattedSample(self):
        return self.SAMPLE_ROUTE_FORMAT

    def formatRoutes(self, routes):
        route_info = dict()
        index = 1
        for i in routes:
            coordinates_for_this_route = []
            html_steps = []

            for j in i["legs"][0]["steps"]:
                coordinates_for_this_route.append(
                    (j["end_location"]["lat"], j["end_location"]["lng"]))
                html_steps.append(j["html_instructions"])
            coordinates_for_this_route.append(
                (i["legs"][0]["end_location"]["lat"], i["legs"][0]["end_location"]["lng"]))
            route_info[index] = {"coordinates": coordinates_for_this_route, "steps": html_steps}
            index += 1

        return route_info

    def getStepCoords(self, formatted_routes: dict):
        return formatted_routes["coordinates"]
